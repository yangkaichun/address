<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>位置助手</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  </head>
  <body class="bg-gray-100">
    <div class="max-w-md mx-auto bg-white rounded-lg shadow-md p-6 mt-10">
      <h1 class="text-2xl font-bold text-center mb-4">位置助手</h1>
      <p id="locationInfo" class="text-gray-700 text-sm mb-4">正在取得您的位置…</p>
      <div class="mb-4">
        <input id="userInput" type="text" placeholder="請輸入查詢內容" class="w-full border border-gray-300 rounded p-2 focus:outline-none focus:border-blue-500" />
      </div>
      <div class="flex justify-between items-center mb-4">
        <button id="textSubmit" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 focus:outline-none">送出</button>
        <button id="voiceBtn" class="border border-gray-300 px-4 py-2 rounded hover:bg-gray-200 focus:outline-none">
          <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 1v22m-4-4h8"></path>
          </svg>
          語音輸入
        </button>
      </div>
      <div id="result" class="p-4 bg-gray-50 border border-gray-200 rounded">
        <p class="text-gray-600 text-sm">請輸入或使用語音查詢附近相關資訊。</p>
      </div>
      <div id="mapLinkContainer" class="mt-4 hidden">
        <a id="mapLink" href="#" target="_blank" class="block text-center bg-green-500 text-white py-2 rounded hover:bg-green-600">前往 Google Maps 導航</a>
      </div>
    </div>
    <script>
      let userLat = null;
      let userLng = null;

      // 取得使用者位置
      function getUserLocation() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            (position) => {
              userLat = position.coords.latitude;
              userLng = position.coords.longitude;
              document.getElementById("locationInfo").textContent = "您的位置: " + userLat.toFixed(5) + ", " + userLng.toFixed(5);
            },
            (error) => {
              document.getElementById("locationInfo").textContent = "無法取得位置資訊。";
              console.error(error);
            }
          );
        } else {
          document.getElementById("locationInfo").textContent = "瀏覽器不支援地理位置服務。";
        }
      }
      getUserLocation();

      // 語音辨識功能
      const voiceBtn = document.getElementById("voiceBtn");
      if (!("webkitSpeechRecognition" in window) && !("SpeechRecognition" in window)) {
        voiceBtn.disabled = true;
        voiceBtn.textContent = "語音不支援";
      } else {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const recognition = new SpeechRecognition();
        recognition.lang = "zh-TW";
        recognition.interimResults = false;
        recognition.maxAlternatives = 1;

        voiceBtn.addEventListener("click", () => {
          recognition.start();
          voiceBtn.textContent = "識別中…";
        });

        recognition.addEventListener("result", (event) => {
          const transcript = event.results[0][0].transcript;
          document.getElementById("userInput").value = transcript;
        });

        recognition.addEventListener("speechend", () => {
          recognition.stop();
          voiceBtn.textContent = "語音輸入";
        });

        recognition.addEventListener("error", (event) => {
          console.error("Error occurred in recognition: " + event.error);
          voiceBtn.textContent = "語音輸入";
        });
      }

      // 處理文字輸入查詢
      document.getElementById("textSubmit").addEventListener("click", () => {
        const query = document.getElementById("userInput").value.trim();
        if(query === ""){
          alert("請輸入查詢內容！");
          return;
        }
        showNearbyInfo(query);
      });

      function showNearbyInfo(query) {
        // 模擬附近資訊顯示，實際應用中可使用適合的免費 API
        const resultDiv = document.getElementById("result");
        resultDiv.innerHTML = "<p class='text-gray-700'>正在搜尋與 “" + query + "” 相關並且靠近您的資訊…</p>";

        // 模擬搜尋結果內容，這裡僅使用一個假項目示範
        setTimeout(() => {
          const infoHTML = "<h2 class='font-semibold mb-2'>查詢結果</h2>" +
                      "<p class='text-gray-600'>假設找到一個地點：示範地點</p>";
          resultDiv.innerHTML = infoHTML;

          // 提供 Google Maps 導航連結
          const mapLinkContainer = document.getElementById("mapLinkContainer");
          const mapLink = document.getElementById("mapLink");
          let destination = encodeURIComponent("示範地點");
          if (userLat && userLng) {
            // 使用使用者位置作為起點，並將目的地設為查詢結果
            mapLink.href = "https://www.google.com/maps/dir/?api=1&origin=" + userLat + "," + userLng + "&destination=" + destination;
          } else {
            // 如果無法取得使用者位置則只搜尋目的地
            mapLink.href = "https://www.google.com/maps/search/?api=1&query=" + destination;
          }
          mapLinkContainer.classList.remove("hidden");
        }, 1500);
      }
    </script>
  </body>
</html>
